<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>ËÆ∞ÂøÜÁîªÊùø</title>
<style>
  :root { --blur-val: 8px; }

  body { 
    margin: 0; overflow: hidden; background: linear-gradient(180deg, #e3f2fd 0%, #f8bbd0 100%); 
    font-family: "Segoe UI", "Microsoft YaHei", sans-serif; height: 100vh; 
    display: flex; justify-content: center; align-items: center;
    position: relative;
  }

  body::before {
    content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-image: 
      radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,0.4), transparent 1px),
      radial-gradient(1px 1px at 60% 70%, rgba(76,175,80,0.08), transparent 1px),
      radial-gradient(1px 1px at 50% 50%, rgba(255,255,255,0.3), transparent 1px),
      radial-gradient(2px 2px at 80% 20%, rgba(198,24,91,0.05), transparent 2px),
      radial-gradient(1px 1px at 10% 80%, rgba(255,255,255,0.35), transparent 1px),
      radial-gradient(1.5px 1.5px at 40% 40%, rgba(76,175,80,0.06), transparent 1.5px);
    background-size: 300px 300px, 250px 250px, 400px 400px, 350px 350px, 280px 280px, 320px 320px;
    background-position: 0 0, 40px 60px, 130px 270px, 70px 100px, 0 0, 40px 40px;
    pointer-events: none; z-index: 1;
  }

  #start-screen {
    position: relative; width: 600px; padding: 30px 40px;
    background: linear-gradient(135deg, #ffffff 0%, #fff5f0 50%, #ffe6e6 100%); 
    border-radius: 15px;
    box-shadow: 0 15px 40px rgba(200, 50, 50, 0.2), 0 0 30px rgba(76, 175, 80, 0.15);
    border: 2px solid #c2185b;
    display: flex; align-items: center; justify-content: space-between;
    z-index: 2000000; transition: opacity 0.5s ease, transform 0.5s ease;
  }

  #start-screen::before {
    content: '‚ùÑÔ∏è'; position: absolute; left: 20px; top: 15px; font-size: 24px; opacity: 0.6;
    animation: float 3s ease-in-out infinite;
  }
  #start-screen::after {
    content: 'üéÑ'; position: absolute; right: 20px; top: 15px; font-size: 28px; opacity: 0.6;
    animation: sway 2s ease-in-out infinite;
  }

  #start-screen > span::before {
    content: '‚ùÑÔ∏è ';
    font-size: 12px;
    margin-right: 5px;
    opacity: 0.4;
  }

  #start-screen > span::after {
    content: ' ‚ùÑÔ∏è';
    font-size: 12px;
    margin-left: 5px;
    opacity: 0.4;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-8px); }
  }

  @keyframes sway {
    0%, 100% { transform: rotate(-2deg); }
    50% { transform: rotate(2deg); }
  }

  #start-screen.fade-out { opacity: 0; transform: scale(0.95); }
  #start-message { font-size: 28px; color: #c2185b; font-weight: 600; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
  #start-button {
    padding: 12px 28px; background: linear-gradient(135deg, #c2185b 0%, #d32f2f 100%); 
    color: white; font-size: 18px; border: 2px solid #4caf50; border-radius: 8px; cursor: pointer;
    box-shadow: 0 4px 15px rgba(194, 24, 91, 0.3); transition: all 0.3s ease;
    font-weight: 600; letter-spacing: 1px;
  }
  #start-button:hover { 
    background: linear-gradient(135deg, #d32f2f 0%, #c2185b 100%);
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 6px 20px rgba(194, 24, 91, 0.4);
  }
  #start-button::before {
    content: 'üéÖ ';
    margin-right: 5px;
  }

  #bg-layer {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(180deg, #e3f2fd 0%, #f8bbd0 100%);
    background-image: 
      linear-gradient(180deg, #e3f2fd 0%, #f8bbd0 100%),
      radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,0.4), transparent 1px),
      radial-gradient(1px 1px at 60% 70%, rgba(76,175,80,0.08), transparent 1px),
      radial-gradient(1px 1px at 50% 50%, rgba(255,255,255,0.3), transparent 1px),
      radial-gradient(2px 2px at 80% 20%, rgba(198,24,91,0.05), transparent 2px),
      radial-gradient(1px 1px at 10% 80%, rgba(255,255,255,0.35), transparent 1px),
      radial-gradient(1.5px 1.5px at 40% 40%, rgba(76,175,80,0.06), transparent 1.5px);
    background-size: 100% 100%, 300px 300px, 250px 250px, 400px 400px, 350px 350px, 280px 280px, 320px 320px;
    background-position: 0 0, 0 0, 40px 60px, 130px 270px, 70px 100px, 0 0, 40px 40px;
    z-index: -1; opacity: 1;
    display: none;
  }

  #bg-layer::before {
    content: ''; position: absolute; top: 2%; right: 3%; width: 80px; height: 80px;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="0" y="80" font-size="100" opacity="0.08">üéÑ</text></svg>');
    background-size: contain; background-repeat: no-repeat; opacity: 0.6;
  }

  #bg-layer::after {
    content: ''; position: absolute; bottom: 5%; left: 5%; width: 70px; height: 70px;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="0" y="80" font-size="100" opacity="0.08">üéÖ</text></svg>');
    background-size: contain; background-repeat: no-repeat; opacity: 0.6;
  }

  #snowflakes {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none; z-index: 50; display: none;
  }

  .snowflake {
    position: absolute; color: white; font-size: 1.5em; text-shadow: 0 0 5px rgba(255,255,255,0.8);
    animation: snowfall 10s linear infinite;
    opacity: 0.6;
  }

  @keyframes snowfall {
    0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
    100% { transform: translateY(100vh) rotate(360deg); opacity: 0.3; }
  }

  .window {
    position: absolute; border-radius: 6px; overflow: hidden;
    box-shadow: 0 8px 25px rgba(0,0,0,0.08), 0 0 10px rgba(198, 24, 91, 0.1); 
    background-color: white; border: 1px solid rgba(198, 24, 91, 0.15); user-select: none;
    transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), box-shadow 0.3s, filter 0.4s ease;
    backface-visibility: hidden; transform-style: preserve-3d;
    display: none;
  }

  .window.is-zoomed {
    transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.4s ease, filter 0.4s ease;
    box-shadow: 0 20px 60px rgba(0,0,0,0.25), 0 0 30px rgba(198, 24, 91, 0.3);
    filter: drop-shadow(0 10px 25px rgba(0,0,0,0.2));
  }

  .window::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, transparent, rgba(198, 24, 91, 0.4), rgba(76, 175, 80, 0.4), transparent);
    z-index: 10;
  }

  .window.active { display: block; animation: win-pop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }

  @keyframes win-pop { 
    0% { transform: scale(0.6); opacity: 0; } 
    100% { transform: scale(1); opacity: 1; } 
  }

  .title-bar {
    background: linear-gradient(90deg, #fff5f0 0%, #ffe6e6 100%); height: 22px; display: flex; align-items: center;
    justify-content: space-between; padding: 0 8px; font-size: 10px; color: #c2185b;
    border-bottom: 1px solid #fcfcfc; cursor: move; font-weight: 600;
  }

  .title-bar::before {
    content: '‚ú®';
    margin-right: 5px;
    font-size: 12px;
  }

  .title-bar::after {
    content: '‚ú®';
    margin-left: 5px;
    font-size: 12px;
  }

  .content { width: 100%; display: flex; align-items: center; justify-content: center; overflow: hidden; cursor: zoom-in; }
  .content-img { 
    width: 100%; height: auto; display: block; pointer-events: none; 
    image-rendering: -webkit-optimize-contrast;
  }

  .content-text { 
    width: 147px; height: 80px; display: flex; align-items: center; justify-content: center;
    padding: 10px; color: #555; font-size: 12px; font-weight: 600; text-align: center;
  }

  #zoom-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(0px);
    display: none; z-index: 1999999; cursor: zoom-out;
    opacity: 0; transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), backdrop-filter 0.4s ease;
  }
  #zoom-overlay.active { backdrop-filter: blur(15px); background: rgba(255, 255, 255, 0.3); opacity: 1; }

  .close-btn { cursor: pointer; font-size: 11px; color: #ccc; transition: color 0.2s; }
  .close-btn:hover { color: #f44336; }
</style>
</head>
<body>

<audio id="bg-music" loop>
  <source src="All I Want for Christmas.m4a" type="audio/mp4">
</audio>

<div id="start-screen">
  <span id="start-message">ÁÇπÂáªÂºÄÂêØÂ±û‰∫éÊàë‰ª¨ÁöÑÂõûÂøÜ</span>
  <button id="start-button">GO!</button>
</div>

<div id="bg-layer"></div>
<div id="snowflakes"></div>
<div id="zoom-overlay"></div>

<script>
  // --- ÈÖçÁΩÆÈ°π ---
  const CONFIG = {
    imageInterval: 600,
    maxWindows: 200,
    cleanupInterval: 1000,
    imageChance: 0.85
  };

  // --- ÂõæÁâáÊï∞ÊçÆÊ±† ---
  const rawImages = [
    "af2cc7644a88d4ccc46c28d8a76b1ff7.JPG", "IMG_0115.JPG", "IMG_0511.JPG", "IMG_0769.JPG", "IMG_0812.JPG", "IMG_0837.jpeg", "IMG_0837.JPG", "IMG_0856.JPG", "IMG_1597.JPG", "IMG_1703.JPG", "IMG_2151.JPG", "IMG_2476.JPG", "IMG_2803.JPG", "IMG_3900.JPG", "IMG_4480.JPG", "IMG_4591.JPG", "IMG_4742.JPG", "IMG_4749.JPG", "IMG_4882.JPG", "IMG_4978.JPG", "IMG_4985.JPG", "IMG_4997.JPG", "IMG_5019.JPG", "IMG_5029.JPG", "IMG_5611.JPG", "IMG_5616.JPG", "IMG_5663.JPG", "IMG_5696.JPG", "IMG_5730.JPG", "IMG_7107.JPG", "IMG_7166.JPG", "IMG_7385.JPG", "IMG_7468.JPG", "IMG_7781.JPG", "IMG_8562.JPG", "IMG_8616.JPG", "IMG_8675.JPG", "IMG_8684.JPG", "IMG_8704.JPG", "IMG_8743.JPG", "IMG_8752.JPG", "IMG_8761.JPG", "IMG_8869.JPG", "IMG_8875.JPG", "IMG_8896.JPG"
  ];

  let imageQueue = [];
  let phraseQueue = [];

  const paleColors = ['rgba(214, 85, 150, 0.3)', 'rgba(202, 113, 195, 0.3)', 'rgba(152, 162, 198, 0.3)', 'rgba(202, 188, 175, 0.3)', 'rgba(232, 224, 162, 0.3)'];
  const rawPhrases = ["Êó©ÁÇπÁù°Ëßâ", "ËÆ∞ÂæóÂñùÊ∞¥", "‰∏çË¶ÅÁÜ¨Â§úÂï¶", "‰∏á‰∫ãÈ°∫ÈÅÇ", "ÊúÄÊ£íÁöÑ‰Ω†", "ÊàëÁà±ËåÉÊøíÂÖÉ", "ÈÄ¢ËÄÉÂøÖËøá", "Âπ≥ÂÆâÂñú‰πê"];
  
  let zIndexCounter = 100;
  let currentZoomed = null;
  const overlay = document.getElementById('zoom-overlay');
  let popupIntervalId = null;
  let cleanupIntervalId = null;

  function shuffle(array) {
    let currentIndex = array.length;
    const newArray = [...array];
    while (currentIndex !== 0) {
      const randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex--;
      [newArray[currentIndex], newArray[randomIndex]] = [newArray[randomIndex], newArray[currentIndex]];
    }
    return newArray;
  }

  function getNextImage() {
    if (imageQueue.length === 0) {
      imageQueue = shuffle(rawImages);
    }
    return imageQueue.pop();
  }

  function getNextPhrase() {
    if (phraseQueue.length === 0) {
      phraseQueue = shuffle(rawPhrases);
    }
    return phraseQueue.pop();
  }

  function createPopup() {
    const win = document.createElement('div');
    win.className = 'window';
    win.style.zIndex = zIndexCounter++;
    win.style.left = Math.floor(Math.random() * (window.innerWidth - 160)) + 'px';
    win.style.top = Math.floor(Math.random() * (window.innerHeight - 160)) + 'px';

    const isImage = Math.random() < CONFIG.imageChance;
    
    if (isImage) {
      const src = getNextImage();
      const img = new Image();
      img.src = src;
      img.className = "content-img";
      img.onload = function() {
        win.style.width = '110px'; 
        win.innerHTML = `<div class="title-bar"><span>Moment</span><div class="title-controls"><span class="close-btn">‚úï</span></div></div><div class="content"></div>`;
        win.querySelector('.content').appendChild(img);
        win.ondblclick = (e) => { e.stopPropagation(); toggleZoom(win); };
        setupWindowControls(win);
        document.body.appendChild(win);
        win.classList.add('active');
      };
      img.onerror = function() { renderText(win); };
    } else {
      renderText(win);
    }
  }

  function renderText(win) {
    const p = getNextPhrase();
    const c = paleColors[Math.floor(Math.random() * paleColors.length)];
    win.style.width = '147px';
    win.innerHTML = `<div class="title-bar"><span>ÊèêÁ§∫</span><div class="title-controls"><span class="close-btn">‚úï</span></div></div><div class="content" style="background:${c}"><div class="content-text">${p}</div></div>`;
    document.body.appendChild(win);
    setupWindowControls(win);
    win.classList.add('active');
  }

  // --- ÂêØÂä®ÈÄªËæë ---
  document.getElementById('start-button').addEventListener('click', function() {
    const audio = document.getElementById('bg-music');
    audio.play().catch(err => console.log('Ëá™Âä®Êí≠ÊîæË¢´ÊµèËßàÂô®ÈòªÊ≠¢ÔºåËØ∑ÊâãÂä®ÁÇπÂáªÈü≥‰πêÊéßÂà∂'));
    
    document.getElementById('start-screen').classList.add('fade-out');
    setTimeout(() => {
      document.getElementById('start-screen').remove();
      document.getElementById('bg-layer').style.display = 'block';
      document.getElementById('snowflakes').style.display = 'block';
      setTimeout(() => document.getElementById('bg-layer').style.opacity = '1', 10);
      
      // ÂàõÂª∫Èõ™Ëä±
      createSnowflakes();
      
      popupIntervalId = setInterval(createPopup, CONFIG.imageInterval);
      cleanupIntervalId = setInterval(() => {
        const all = document.querySelectorAll('.window:not(.is-zoomed)');
        if (all.length > CONFIG.maxWindows) {
          all[0].remove();
        }
      }, CONFIG.cleanupInterval);
    }, 500);
  });

  function createSnowflakes() {
    const snowflakesContainer = document.getElementById('snowflakes');
    const snowflakeEmojis = ['‚ùÑÔ∏è', '‚ùÖ', '‚ùÜ', '‚õÑ'];
    
    for (let i = 0; i < 30; i++) {
      const snowflake = document.createElement('div');
      snowflake.className = 'snowflake';
      snowflake.textContent = snowflakeEmojis[Math.floor(Math.random() * snowflakeEmojis.length)];
      snowflake.style.left = Math.random() * 100 + '%';
      snowflake.style.animationDelay = Math.random() * 10 + 's';
      snowflake.style.animationDuration = (Math.random() * 5 + 10) + 's';
      snowflakesContainer.appendChild(snowflake);
    }
  }

  // --- Áº©ÊîæÈÄªËæë ---
  function toggleZoom(el) {
    if (currentZoomed && currentZoomed !== el) return;
    if (!el.classList.contains('is-zoomed')) {
      currentZoomed = el;
      el.classList.add('is-zoomed');
      el.dataset.oriZ = el.style.zIndex;
      el.style.zIndex = 2000000;
      el.style.transformOrigin = 'center';
      const rect = el.getBoundingClientRect();
      const moveX = (window.innerWidth / 2) - (rect.left + rect.width / 2);
      const moveY = (window.innerHeight / 2) - (rect.top + rect.height / 2);
      const scale = Math.min((window.innerWidth * 0.9) / rect.width, (window.innerHeight * 0.85) / rect.height);
      el.style.transform = `translate3d(${moveX}px, ${moveY}px, 0) scale(${scale})`;
      overlay.style.display = 'block';
      setTimeout(() => overlay.classList.add('active'), 10);
      overlay.onclick = el.onclick = () => toggleZoom(el);
    } else {
      el.classList.remove('is-zoomed');
      el.style.transform = 'translate3d(0,0,0) scale(1)';
      overlay.classList.remove('active');
      setTimeout(() => {
        overlay.style.display = 'none';
        el.style.zIndex = el.dataset.oriZ;
        currentZoomed = null;
      }, 500);
    }
  }

  // --- Á™óÂè£ÊéßÂà∂‰ºòÂåñ ---
  function setupWindowControls(el) {
    const titleBar = el.querySelector(".title-bar");
    const closeBtn = el.querySelector('.close-btn');
    
    closeBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      el.remove();
    });

    el.addEventListener('mousedown', () => { 
      if (!el.classList.contains('is-zoomed')) {
        el.style.zIndex = zIndexCounter++;
      }
    });

    let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    titleBar.addEventListener('mousedown', (e) => {
      if (el.classList.contains('is-zoomed')) return;
      e.stopPropagation();
      pos3 = e.clientX;
      pos4 = e.clientY;
      
      const onMouseMove = (e) => {
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        el.style.top = (el.offsetTop - pos2) + "px";
        el.style.left = (el.offsetLeft - pos1) + "px";
      };

      const onMouseUp = () => {
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
      };

      document.addEventListener('mousemove', onMouseMove);
      document.addEventListener('mouseup', onMouseUp);
    });
  }
</script>
</body>
</html>
